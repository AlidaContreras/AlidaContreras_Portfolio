YUI.add("flickr-braintree-customerDetails-fetcher",function(e,t){"use strict";require("hermes-core/flog")(t);e.namespace("ModelFetchers")["flickr-braintree-customerDetails-fetcher"]={run:function(s,r){var i=this,a=this._processParams(s);return e.Promise.all([r.callAPI("flickr.subscriptions.braintree.getCustomerDetails",a,!0),r.getModelRegistry("products-address-models"),r.getModelRegistry("subscription-history-list-models"),r.getModelRegistry("subscription-history-models")]).then(function(e){return i._processResponse(e,s,r)},e.PromiseCatcher(t))},_processParams:function(e){return{account_id:e.id}},_processResponse:function(t,s,r){var i,a,o=t[0],n=t[1],d=t[2],c=t[3],l={};a=o.customerDetails.subscriptions,(i=o.customerDetails.addresses)&&i instanceof Array&&i.forEach(function(e){var t={};t={firstName:e.firstName,lastName:e.lastName,street1:e.street1,street2:e.street2,city:e.city,state:e.state,postalCode:e.postalCode,countryCode:e.countryCode,phone:e.phone},n.exists(e.id)?n.setValues(e.id,t):(t.id=e.id,n.add(t))}),a&&a instanceof Array&&(l.subscriptions=a.map(function(t){var s={};return t.status=parseInt(t.status,10),t.type=parseInt(t.type,10),s.startDate=1e3*t.startDate,s.billingScheduleMonths=t.billingScheduleMonths,s.nextBillingDate=1e3*t.nextBillingDate,s.effectiveEndDate=1e3*t.effectiveEndDate,s.type=t.type,s.paymentMethodId=t.paymentMethodId,s.status=t.status,s.amountBilled=t.amountBilled,s.transactions=t.transactions,s.prettyName=t.planInfo.prettyName,s.prettyNameDuration=t.planInfo.prettyNameDuration,s.pendingPrice=t.pendingPrice||void 0,e.Array.each(s.transactions,function(t){t.formattedCreateDate=e.moment(t.dateCreate,"X").format("MMM Do, YYYY"),t.isRefund=!1,3===parseInt(t.transactionType,10)&&(t.isRefund=!0)}),c.exists(t.id)?(c.setValues(t.id,s),c.proxy(t.id)):(s.id=t.id,c.add(s))}),o.customerDetails.paymentHistory&&(l.oneTimePro=o.customerDetails.paymentHistory.proStatus)),d.exists(s.id)?d.setValues(s.id,l):(l.id=s.id,d.add(l))}}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["subscription-history-models","subscription-history-list-models","products-address-models"]});YUI.add("subscription-history-models",function(t){function e(t){e.superclass.constructor.call(this,t)}t.Models[this.name]=e,t.extend(e,t.FlickrModelRegistry,{name:this.name,remote:{update:function(e,r){return t.ModelUpdaters["flickr-subscriptions-changePlan-updater"].run({current_plan_type:r.type.prevVal,new_plan_type:r.type.newVal},this.appContext)},delete:function(e,r){return t.ModelDeletors["flickr-braintree-close-deletor"].run({subscription_id:e},this.appContext)}},attributes:{startDate:{validator:function(e,r){return!(parseInt(e,10)>0)||t.AttributeHelpers.validateDate(e)},setter:function(e){if(parseInt(e,10)>0)return t.AttributeHelpers.coerceDate(e)||void 0},serialize:function(t){return t.format("X")},deserialize:function(e){return t.moment(e,"X")},defaultFn:function(t){}},nextBillingDate:{validator:function(e,r){return!(parseInt(e,10)>0)||t.AttributeHelpers.validateDate(e)},setter:function(e){if(parseInt(e,10)>0)return t.AttributeHelpers.coerceDate(e)||void 0},serialize:function(t){return t.format("X")},deserialize:function(e){return t.moment(e,"X")},defaultFn:function(t){}},effectiveEndDate:{validator:function(e,r){return!(parseInt(e,10)>0)||t.AttributeHelpers.validateDate(e)},setter:function(e){if(parseInt(e,10)>0)return t.AttributeHelpers.coerceDate(e)||void 0},serialize:function(t){return t.format("X")},deserialize:function(e){return t.moment(e,"X")},defaultFn:function(t){}},billingScheduleMonths:{validator:function(e,r){return t.AttributeHelpers.validateInteger(e)},setter:function(e){return t.AttributeHelpers.coerceInteger(e)||void 0},defaultFn:function(t){return 0}},type:{validator:function(e,r){return t.AttributeHelpers.validateInteger(e)},setter:function(e){return t.AttributeHelpers.coerceInteger(e)||void 0},defaultFn:function(t){return-1}},paymentMethodId:{validator:function(e,r){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)||void 0},defaultFn:function(t){return""}},prettyName:{validator:function(e,r){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)||void 0},defaultFn:function(t){return""}},prettyNameDuration:{validator:function(e,r){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)||void 0},defaultFn:function(t){return""}},status:{validator:function(e,r){return t.AttributeHelpers.validateInteger(e)},setter:function(e){return t.AttributeHelpers.coerceInteger(e)||void 0},defaultFn:function(t){return-1}},amountBilled:{validator:function(e,r){return t.AttributeHelpers.validateFloat(e)},setter:function(e){return t.AttributeHelpers.coerceFloat(e)||void 0},defaultFn:function(t){return 0}},pendingPrice:{validator:function(e,r){return t.AttributeHelpers.validateFloat(e)},setter:function(e){return t.AttributeHelpers.coerceFloat(e)||void 0},defaultFn:function(t){return 0}},transactions:{}}})},"@VERSION@",{requires:["flickr-braintree-customerDetails-fetcher","flickr-braintree-close-deletor","flickr-subscriptions-changePlan-updater"]});YUI.add("account-menu-view",function(e,t){"use strict";var o=require("hermes-core/flog")(t);e.namespace("Views")[this.name]=e.Base.create("account-menu-view",e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this},loadState:function(){var t=this,o=[],n=this.appContext.getViewer();return n.signedIn?(t.set("user",{signedIn:!0,csrf:this.appContext.auth.csrf?this.appContext.auth.csrf:""}),o.push(this.appContext.getModel("person-models",n.nsid).then(function(o){var n=o.toJSON();Object.keys(n.buddyicon||{}).forEach(function(e){n.buddyicon[e]||(n.buddyicon[e]=n.buddyicon.default)}),t.set("user",e.merge(t.get("user"),n))})),o.push(t.appContext.getModel("person-profile-models",n.nsid).then(function(o){var n=o.toJSON();n.unreadMessages=parseInt(n.unreadMessages,10),n.storageUsed=parseInt(n.storageUsed,10),t.get("user").isPro&&!t.appContext.flipper.isFlipped("enable-new-pro")?t.get("user").hasAdfree||t.get("user").has1TB||t.get("user").has2TB?n.storageTotal=parseInt(n.storageTotal,10):n.storageTotal=-1:n.storageTotal=parseInt(n.storageTotal,10),t.set("user",e.merge(t.get("user"),n))})),e.Promise.all(o)):(t.set("user",{signedIn:!1}),e.Promise.resolve())},buildContainer:function(){return this.setContainerWithTemplate("account-menu",this.toJSON()),this},toJSON:function(){var t=e.merge(this.get("user")),o=this.appContext.lang;return parseInt(t.photoCount,10)>1?t.pluralPhotos=!0:t.pluralPhotos=!1,parseInt(t.photoCount,10)<1&&(t.photoCount=!1),t.photoCount>1e3&&(t.photoCount=Math.round(t.photoCount/1e3),t.oneK=!0),this.appContext.flipper.isFlipped("enable-new-pro")?t.hasUnlimitedStorage?t.storageTotalFormatted="":t.has1TB?t.storageTotalFormatted="1TB":t.has2TB?t.storageTotalFormatted="2TB":t.storageTotalFormatted=t.storageTotal<0?"":e.Handlebars.helpers.friendlyDataSize(t.storageTotal):t.storageTotalFormatted=t.storageTotal<0?"":e.Handlebars.helpers.friendlyDataSize(t.storageTotal),"zh-Hant-HK"===o&&(o="zh-HK"),"vi-vn"===o.toLowerCase()&&(o="vn-VN"),t.storageUsedPercentage=Math.floor(1e3*t.storageUsed/t.storageTotal)/10||"0.0",t.storageUsedFormatted=e.Handlebars.helpers.friendlyDataSize(t.storageUsed),t.barWidth=Math.floor(t.storageUsedPercentage/100*293),t.unreadMessages=t.unreadMessages>9999?"9999+":t.unreadMessages,{user:t,helpLocaleKey:o.replace("-","_")||"en_US",flippers:this.appContext.flipper.toJSON()}},activate:function(){setTimeout(function(){this.get("container").on(["click","keydown"],function(e){"click"!==e.type&&13!==e.keyCode&&32!==e.keyCode||(!this.accountMenuDialog||this.accountMenuDialog.isClosed?this.openMenu(e):this.closeMenu(e))},this)}.bind(this),350)},openMenu:function(t){var o,n=this.get("container");return t.preventDefault(),t.stopPropagation(),this.fire("open"),this.accountMenuDialog||(o=this.templates("account-menu-card"),this.accountMenuDialog=new e.Views.FluidDroparound({appContext:this.appContext,dismissOnOverlayClick:!0,showDropArrow:!0,showOverlay:!1,width:322,height:"auto",anchorOffsetHorizontal:5,observePageResize:!0,anchorElement:n.one(".c-account-menu"),keyboardAnchorElement:n.one("a[aria-haspopup=true]"),htmlMessage:o({attrs:this.toJSON()}),positionFixed:!0}),this.appContext.flipper.isFlipped("enable-new-pro")&&this.showGetProButton()),this.accountMenuDialog.show(),this.appContext.flipper.isFlipped("enable-new-pro")&&this.on("open",this.showGetProButton),this},closeMenu:function(e){e&&e.preventDefault(),this.accountMenuDialog&&this.accountMenuDialog.close()},showGetProButton:function(){var t=!1,n=!1,s=[],a=this.appContext.getViewer();s.push(this.appContext.getModel("subscription-info-models",a.nsid).then(function(e){e.getValue("products").forEach(function(e){e.canPurchase&&(t=!0)}),!t&&this.accountMenuDialog.get("container").one(".upgrade")&&this.accountMenuDialog.get("container").one(".upgrade").remove(!0)}.bind(this))),s.push(this.appContext.getModel("subscription-history-list-models",a.nsid).then(function(e){e.getValue("subscriptions")&&(e.getValue("subscriptions").toJSON().forEach(function(e){!e.effectiveEndDate&&!e.nextBillingDate||3!==e.status&&12!==e.status||(n=!0)}),this.get("user").hasUnlimitedStorage&&(n=!0))}.bind(this))),e.Promise.all(s).then(function(){var e=this.templates("account-menu-card-get-pro-button")({canPurchase:!n&&t,canResubscribe:n});this.accountMenuDialog.get("container").one(".upgrade").replace(e),this.accountMenuDialog.get("container").one(".content").setStyles({height:"auto"})}.bind(this),function(e){o.warn("Error fetching model.",{err:e})})},destructor:function(){this.accountMenuDialog&&(this.accountMenuDialog.destroy(),this.accountMenuDialog=null)}})},"@VERSION@",{requires:["flickr-view","hermes-template-account-menu","hermes-template-account-menu-dialog-styleguide","hermes-template-account-menu-card","hermes-template-account-menu-card-get-pro-button","fluid-droparound-view","subscription-history-list-models"],optional:["person-models","person-profile-models"],langBundles:["account-menu","common","autosuggest"]});YUI.add("hermes-lang-account-menu_es-us",function(a,s){a.Intl.add("hermes/account-menu","es-US",{SPACE_USED:["Usando ","${percentage}","% de ","${total}"],SPACE_USED_STYLEGUIDE:["${percentage}"," % usado de ","${total}"],SPACE_USED_UNLIMITED:["Estas usando ","${used}"," de tu almacenamiento ilimitado."],PHOTO_COUNT_MANY:[{type:"number",valueName:"num"}," fotos"],PHOTO_COUNT_ONE:["Una foto"],PHOTO_COUNT_NONE:["Sin fotos"],PHOTO_COUNT_1K:[{type:"number",valueName:"num"},"000 fotos"],ADDMORESPACE:["Añadir más espacio"],GOADFREE:["¡Libérate de la publicidad!"],GOPRO:["Versión Pro"],GETPRO:["Obtener Flickr Pro"],RESUBSCRIBE_TO_PRO:["Volver a suscribirse a Flickr Pro"],GREETING_CAPTION_SPANISH:["Ahora ya sabes cómo saludar en español"],GREETING_CAPTION_GERMAN:["Ahora ya sabes cómo saludar en alemán"],GREETING_CAPTION_AUSTRALIAN:["Ahora ya sabes cómo saludar en australiano"],GREETING_CAPTION_DUTCH:["Ahora ya sabes cómo saludar en holandés"],GREETING_CAPTION_ENGLISH:["Ahora ya sabes cómo saludar en inglés"],GREETING_CAPTION_ARABIC:["Ahora ya sabes cómo saludar en árabe"],GREETING_CAPTION_FRENCH:["Ahora ya sabes cómo saludar en francés"],GREETING_CAPTION_ITALIAN:["Ahora ya sabes cómo saludar en italiano"],GREETING_CAPTION_SWEDISH:["Ahora ya sabes cómo saludar en sueco"],GREETING_CAPTION_HAWAIIAN:["Ahora ya sabes cómo saludar en hawaiano"],GREETING_CAPTION_TAGALOG:["Ahora ya sabes cómo saludar en tagalo"],GREETING_CAPTION_HEBREW:["Ahora ya sabes cómo saludar en hebreo"],GREETING_CAPTION_HINDI:["Ahora ya sabes cómo saludar en hindi"],GREETING_CAPTION_MANDARIN:["Ahora ya sabes cómo saludar en mandarín"],GREETING_CAPTION_PORTUGUESE:["Ahora ya sabes cómo saludar en portugués"],GREETING_CAPTION_ALBANIAN:["Ahora ya sabes cómo saludar en albanés"],GREETING_CAPTION_ESTONIAN:["Ahora ya sabes cómo saludar en estoniano"],GREETING_CAPTION_GREEK:["Ahora ya sabes cómo saludar en griego"],GREETING_CAPTION_HUNGARIAN:["Ahora ya sabes cómo saludar en húngaro"],GREETING_CAPTION_LINGALA:["Ahora ya sabes cómo saludar en lingala"],GREETING_CAPTION_SWAHILI:["Ahora ya sabes cómo saludar en suajili"],GREETING_CAPTION_TSHILUBA:["Ahora ya sabes cómo saludar en chiluba"],GREETING_CAPTION_TURKISH:["Ahora ya sabes cómo saludar en turco"],GREETING_CAPTION_BURMESE:["Ahora ya sabes cómo saludar en birmano"],GREETING_CAPTION_ICELANDIC:["Ahora ya sabes cómo saludar en islandés"],GREETING_CAPTION_ZULU:["Ahora ya sabes cómo saludar en zulu"],GREETING_CAPTION_KOREAN:["Ahora ya sabes cómo saludar en coreano"],GREETING_CAPTION_IRISH:["Ahora ya sabes cómo saludar en irlandés"],GREETING_CAPTION_LATVIAN:["Ahora ya sabes cómo saludar en letón"],GREETING_CAPTION_BASQUE:["Ahora ya sabes cómo saludar en vasco"],GREETING_CAPTION_BENGALI:["Ahora ya sabes cómo saludar en bengalí"],GREETING_CAPTION_BULGARIAN:["Ahora ya sabes cómo saludar en búlgaro"],GREETING_CAPTION_CROATIAN:["Ahora ya sabes cómo saludar en croata"],GREETING_CAPTION_CZECH:["Ahora ya sabes cómo saludar en checo"],GREETING_CAPTION_DANISH:["Ahora ya sabes cómo saludar en danés"],GREETING_CAPTION_FINNISH:["Ahora ya sabes cómo saludar en finés"],GREETING_CAPTION_HOPI:["Ahora ya sabes cómo saludar en hopi"],GREETING_CAPTION_INDONESIAN:["Ahora ya sabes cómo saludar en indonesio"],GREETING_CAPTION_KANNADA:["Ahora ya sabes cómo saludar en canarés"],GREETING_CAPTION_KURDISH:["Ahora ya sabes cómo saludar en kurdo"],GREETING_CAPTION_LITHUANIAN:["Ahora ya sabes cómo saludar en lituano"],GREETING_CAPTION_MALAYSIAN:["Ahora ya sabes cómo saludar en malayo"],GREETING_CAPTION_NORWEGIAN:["Ahora ya sabes cómo saludar en noruego"],GREETING_CAPTION_POLISH:["Ahora ya sabes cómo saludar en polaco"],GREETING_CAPTION_ROMANIAN:["Ahora ya sabes cómo saludar en rumano"],GREETING_CAPTION_RUSSIAN:["Ahora ya sabes cómo saludar en ruso"],GREETING_CAPTION_SERBIAN:["Ahora ya sabes cómo saludar en serbio"],GREETING_CAPTION_SLOVAKIAN:["Ahora ya sabes cómo saludar en eslovaco"],GREETING_CAPTION_UKRAINIAN:["Ahora ya sabes cómo saludar en ucraniano"],GREETING_CAPTION_VIETNAMESE:["Ahora ya sabes cómo saludar en vietnamita"]})},"@VERSION@",{requires:["intl"]});